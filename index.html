<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Histuri.com</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="histuri-icon.png">

<style>
body {
  font-family: sans-serif;
  background: #fff7e6;
  margin: 0;
  padding: 0;
}
header {
  background: linear-gradient(45deg,#ff9b32,#ffda4f,#7c5bff,#00d6c9);
  padding: 15px;
  color: white;
  font-size: 22px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.menu-btn {
  font-size: 30px;
  cursor: pointer;
}
.sidebar {
  position: fixed;
  top: 0; right: -250px;
  width: 250px;
  height: 100%;
  background: #fff;
  box-shadow: -3px 0 10px rgba(0,0,0,0.2);
  transition: .3s;
  padding-top: 50px;
}
.sidebar a {
  display:block;
  padding: 15px;
  font-size: 18px;
  text-decoration:none;
  color:#333;
  border-bottom:1px solid #eee;
}
.section {
  padding: 20px;
  display:none;
}
.section.active {
  display:block;
}
.list-box {
  background:white;
  padding:15px;
  margin:12px 0;
  border-radius:10px;
  box-shadow:0 3px 8px rgba(0,0,0,0.1);
}
img.story-img {
  max-width:100%;
  border-radius:10px;
  margin-top:10px;
}
button {
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <div>Histuri.com</div>
  <div class="menu-btn" onclick="openMenu()">☰</div>
</header>

<div class="sidebar" id="menuBox">
  <a onclick="showSection('history')">تاریخی</a>
  <a onclick="showSection('politics')">سیاسی</a>
  <a onclick="showSection('about')">درباره ما</a>
  <a onclick="showSection('manager')">مدیریت محتوا</a>
</div>

<!-- بخش‌های سایت -->
<div id="history" class="section active">
  <h2>داستان‌های تاریخی</h2>
  <div id="historyList"></div>
</div>

<div id="politics" class="section">
  <h2>مقالات سیاسی</h2>
  <div id="politicsList"></div>
</div>

<div id="about" class="section">
  <h2>درباره Histuri</h2>
  <p>
    این سایت با هدف گسترش اطلاعات عمومی، تاریخی و سیاسی ساخته شده است.  
    طراحی و توسعه توسط **piex8** انجام شده.
  </p>
</div>

<!-- مدیریت محتوا -->
<div id="manager" class="section">
  <h2>مدیریت محتوا</h2>

  <h3>افزودن داستان تاریخی</h3>
  <input id="hTitle" placeholder="عنوان">
  <textarea id="hText" placeholder="متن"></textarea>
  <input id="hImg" type="file">
  <button onclick="addItem('history')">افزودن داستان</button>

  <hr>

  <h3>افزودن مقاله سیاسی</h3>
  <input id="pTitle" placeholder="عنوان">
  <textarea id="pText" placeholder="متن"></textarea>
  <input id="pImg" type="file">
  <button onclick="addItem('politics')">افزودن مقاله</button>
</div>

<script>
function openMenu(){ 
  document.getElementById('menuBox').style.right="0";
  setTimeout(()=>{},3000);
}
window.onclick = function(e){
  if(!e.target.closest("#menuBox") && !e.target.closest(".menu-btn")){
    document.getElementById('menuBox').style.right="-250px";
  }
};

function showSection(id){
  document.querySelectorAll(".section").forEach(x=>x.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function getData(){
  return JSON.parse(localStorage.getItem("histuriData") || '{"history":[],"politics":[]}');
}
function saveData(d){
  localStorage.setItem("histuriData", JSON.stringify(d));
}

function addItem(type){
  let title = document.getElementById(type=="history"?"hTitle":"pTitle").value;
  let text = document.getElementById(type=="history"?"hText":"pText").value;
  let imgFile = document.getElementById(type=="history"?"hImg":"pImg").files[0];

  if(!title||!text) return alert("همه فیلدها لازم‌اند");

  let reader = new FileReader();
  reader.onload = function(){
    let data = getData();
    data[type].push({title,text,img:reader.result});
    saveData(data);
    showList();
    alert("افزوده شد!");
  }
  if(imgFile) reader.readAsDataURL(imgFile);
  else reader.onload();
}

function showList(){
  let data = getData();

  let hHTML = "";
  data.history.forEach((item,i)=>{
    hHTML += boxTemplate(item,i,"history");
  });
  document.getElementById("historyList").innerHTML=hHTML;

  let pHTML = "";
  data.politics.forEach((item,i)=>{
    pHTML += boxTemplate(item,i,"politics");
  });
  document.getElementById("politicsList").innerHTML=pHTML;
}

function boxTemplate(item,index,type){
  return `
  <div class='list-box'>
    <h3>${item.title}</h3>
    <p>${item.text.substring(0,120)}...</p>
    ${item.img ? `<img class="story-img" src="${item.img}">` : ""}
    <button onclick='readMore(${index},"${type}")'>ادامه مطلب</button>
    <button onclick='deleteItem(${index},"${type}")'>حذف</button>
  </div>`;
}

function readMore(i,type){
  let item = getData()[type][i];
  alert(item.title + "\n\n" + item.text);
}

function deleteItem(i,type){
  let data = getData();
  data[type].splice(i,1);
  saveData(data);
  showList();
}

showList();
</script>

</body>
</html>
